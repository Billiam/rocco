#!/usr/bin/env ruby
libdir = File.expand_path('../../lib', __FILE__).sub(/^#{Dir.pwd}\//, '')

begin
  require 'rdiscount'
  require 'rocco'
rescue LoadError
  case $!.to_s
  when /rdiscount/
    if !defined?(Gem)
      warn "warn: #$!. trying again with rubygems"
      require 'rubygems'
      retry
    end
  when /rocco/
    if !$:.include?(libdir)
      warn "warn: #$!. trying again with #{libdir} on load path"
      $:.unshift(libdir)
      retry
    end
  end
  raise
end

rocco =
  Rocco.new(ARGV[0]) do
    if $stdin.tty?
      File.read(ARGV[0])
    else
      $stdin.read
    end
  end

$stdout.write(rocco.to_html)
